<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      height: 100%;
      width: 200px;
      background-color: #2c3e50;
      color: white;
      padding: 20px 0;
      transition: transform 0.3s ease;
      z-index: 100;
    }
    .sidebar.hidden {
      transform: translateX(-200px);
    }
    .sidebar .menu-item {
      padding: 10px 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      color: white;
      text-decoration: none;
      transition: background-color 0.2s ease;
    }
    .sidebar .menu-item:hover {
      background-color: #34495e;
    }
    .sidebar .menu-item img {
      margin-right: 10px;
      filter: invert(1);
    }
    .main-content {
      margin-left: 220px;
      padding: 20px;
      transition: margin-left 0.3s ease;
      min-height: 100vh;
    }
    .main-content.full {
      margin-left: 20px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .tabs {
      margin-bottom: 20px;
    }
    .table-container {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .table th, .table td {
      vertical-align: middle;
      transition: background-color 0.2s ease;
    }
    .table tr:hover {
      background-color: #f9f9f9;
    }
    .pagination {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .pagination .select {
      margin-right: 10px;
    }
    .pagination .buttons {
      display: flex;
      gap: 5px;
    }
    .more-menu {
      position: relative;
    }
    .more-menu .dropdown-menu {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      background-color: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      border-radius: 5px;
      z-index: 10;
      min-width: 100px;
    }
    .more-menu:hover .dropdown-menu {
      display: block;
    }
    .more-menu .dropdown-item {
      padding: 5px 10px;
      cursor: pointer;
    }
    .more-menu .dropdown-item:hover {
      background-color: #f5f5f5;
    }
    .avatar {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      margin-right: 10px;
    }
    .logo {
      width: 40px;
      height: 40px;
      margin-bottom: 20px;
      margin-left: 20px;
    }
    .search-bar {
      margin-bottom: 20px;
      max-width: 300px;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      transition: opacity 0.5s ease;
    }
    .th-sortable {
      cursor: pointer;
      position: relative;
    }
    .th-sortable:hover::after {
      content: "‚Üï";
      position: absolute;
      right: 5px;
    }
    .th-sortable.asc::after {
      content: "‚Üë";
      position: absolute;
      right: 5px;
    }
    .th-sortable.desc::after {
      content: "‚Üì";
      position: absolute;
      right: 5px;
    }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar">
    <img src="https://via.placeholder.com/40" alt="Logo" class="logo">
    <a href="#" class="menu-item" data-menu="1"> <img src="https://via.placeholder.com/20" alt="icon"> Menu Item 1 </a>
    <a href="#" class="menu-item" data-menu="2"> <img src="https://via.placeholder.com/20" alt="icon"> Menu Item 2 </a>
    <a href="#" class="menu-item" data-menu="3"> <img src="https://via.placeholder.com/20" alt="icon"> Menu Item 3 </a>
    <a href="#" class="menu-item" data-menu="4"> <img src="https://via.placeholder.com/20" alt="icon"> Menu Item 4 </a>
    <a href="#" class="menu-item" data-menu="5"> <img src="https://via.placeholder.com/20" alt="icon"> Menu Item 5 </a>
    <a href="#" class="menu-item" data-menu="6"> <img src="https://via.placeholder.com/20" alt="icon"> Menu Item 6 </a>
  </div>

  <div class="main-content" id="main-content">
    <div class="header">
      <h1 class="title is-4">Customers</h1>
      <div>
        <button class="button is-light" id="toggle-sidebar">
          <span class="icon">‚ò∞</span>
        </button>
        <button class="button is-light" id="export-btn">
          <span class="icon">üì§</span>
          <span>Export</span>
        </button>
        <button class="button is-primary" id="new-customer-btn">
          <span class="icon">+</span>
          <span>New Customer</span>
        </button>
      </div>
    </div>

    <div class="tabs is-boxed">
      <ul>
        <li class="is-active" data-tab="all"><a>All</a></li>
        <li data-tab="accounts"><a>Accounts</a></li>
        <li data-tab="guests"><a>Guests</a></li>
      </ul>
    </div>

    <div class="field search-bar">
      <p class="control has-icons-left">
        <input class="input" type="text" id="search-input" placeholder="Search by name or email">
        <span class="icon is-small is-left">üîç</span>
      </p>
    </div>

    <div class="table-container">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <p><strong id="total-count"></strong></p>
        <button class="button is-danger is-small" id="bulk-delete-btn" style="display: none;">
          Bulk Delete
        </button>
      </div>
      <table class="table is-fullwidth is-striped">
        <thead>
          <tr>
            <th><input type="checkbox" id="select-all"></th>
            <th class="th-sortable" data-sort="name">Customer</th>
            <th>Type</th>
            <th class="th-sortable" data-sort="email">Email</th>
            <th class="th-sortable" data-sort="phone">Phone</th>
            <th>Default Payment Method</th>
            <th class="th-sortable" data-sort="date">Create Date</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="customer-table">
          <!-- Data will be populated via JavaScript -->
        </tbody>
      </table>

      <div class="pagination" role="navigation" aria-label="pagination">
        <div>
          <span>Show</span>
          <div class="select is-small">
            <select id="page-size">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
            </select>
          </div>
          <span>of <span id="total-results"></span> results</span>
        </div>
        <div class="buttons" id="pagination-buttons">
          <!-- Pagination buttons will be dynamically generated -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for New Customer -->
  <div class="modal" id="new-customer-modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Add New Customer</p>
        <button class="delete" aria-label="close" id="close-modal"></button>
      </header>
      <section class="modal-card-body">
        <div class="field">
          <label class="label">Name</label>
          <div class="control">
            <input class="input" type="text" id="new-name" placeholder="Enter customer name">
          </div>
        </div>
        <div class="field">
          <label class="label">Type</label>
          <div class="control">
            <div class="select">
              <select id="new-type">
                <option value="Guest">Guest</option>
                <option value="Account">Account</option>
              </select>
            </div>
          </div>
        </div>
        <div class="field">
          <label class="label">Email</label>
          <div class="control">
            <input class="input" type="email" id="new-email" placeholder="Enter email">
          </div>
        </div>
        <div class="field">
          <label class="label">Phone</label>
          <div class="control">
            <input class="input" type="text" id="new-phone" placeholder="Enter phone (e.g., +9779814636172 or 9814636172)">
          </div>
        </div>
      </section>
      <footer class="modal-card-foot">
        <button class="button is-success" id="save-customer">Save</button>
        <button class="button" id="cancel-modal">Cancel</button>
      </footer>
    </div>
  </div>

  <script>
    // Sample customer data with Nepal phone numbers
    let customers = [
      { name: "Ram Shrestha", type: "Guest", email: "ramshrestha@gmail.com", phone: "+9779814636172", payment: "****7836", date: "2023-02-15" },
      { name: "Sita Adhikari", type: "Account", email: "sitaadhikari@yahoo.com", phone: "9841234567", payment: "****7836", date: "2020-03-19" },
      { name: "Hari Sharma", type: "Account", email: "harisharma@hotmail.com", phone: "+9779854321098", payment: "****7836", date: "2020-10-16" },
      { name: "Gita Thapa", type: "Guest", email: "gitathapa@gmail.com", phone: "9816543210", payment: "****7836", date: "2021-08-29" },
      { name: "Bikash Gurung", type: "Account", email: "bikashgurung@yahoo.com", phone: "+9779845678901", payment: "****7836", date: "2021-01-19" },
      { name: "Anita Lama", type: "Guest", email: "anitalama@hotmail.com", phone: "9861234567", payment: "****7836", date: "2022-01-05" },
      { name: "Kamal Rai", type: "Account", email: "kamalrai@gmail.com", phone: "+9779834567890", payment: "****7836", date: "2020-06-14" },
      { name: "Puja Tamang", type: "Guest", email: "pujatamang@yahoo.com", phone: "9849876543", payment: "****7836", date: "2023-05-16" },
      { name: "Suresh Karki", type: "Account", email: "sureshkarki@hotmail.com", phone: "+9779823456789", payment: "****7836", date: "2020-04-15" },
      { name: "Laxmi Bhattarai", type: "Guest", email: "laxmibhattarai@gmail.com", phone: "9812345678", payment: "****7836", date: "2022-02-25" },
    ];

    let currentPage = 1;
    let pageSize = 10;
    let currentTab = "all";
    let currentMenuFilter = "all";
    let searchQuery = "";
    let sortKey = null;
    let sortDirection = "asc";

    // Sidebar toggle
    const sidebar = document.getElementById("sidebar");
    const mainContent = document.getElementById("main-content");
    document.getElementById("toggle-sidebar").addEventListener("click", () => {
      sidebar.classList.toggle("hidden");
      mainContent.classList.toggle("full");
    });

    // Menu item functionality
    document.querySelectorAll(".menu-item").forEach(item => {
      item.addEventListener("click", (e) => {
        e.preventDefault();
        currentMenuFilter = item.dataset.menu;
        currentPage = 1;
        renderTable();
        document.querySelectorAll(".menu-item").forEach(i => i.style.backgroundColor = "");
        item.style.backgroundColor = "#34495e";
      });
    });

    // Tab switching
    document.querySelectorAll(".tabs li").forEach(tab => {
      tab.addEventListener("click", (e) => {
        e.preventDefault();
        document.querySelectorAll(".tabs li").forEach(t => t.classList.remove("is-active"));
        tab.classList.add("is-active");
        currentTab = tab.dataset.tab;
        currentPage = 1;
        renderTable();
      });
    });

    // Search functionality
    document.getElementById("search-input").addEventListener("input", (e) => {
      searchQuery = e.target.value.toLowerCase();
      currentPage = 1;
      renderTable();
    });

    // Sorting functionality
    document.querySelectorAll(".th-sortable").forEach(th => {
      th.addEventListener("click", () => {
        const key = th.dataset.sort;
        if (sortKey === key) {
          sortDirection = sortDirection === "asc" ? "desc" : "asc";
        } else {
          sortKey = key;
          sortDirection = "asc";
        }
        document.querySelectorAll(".th-sortable").forEach(t => {
          t.classList.remove("asc", "desc");
        });
        th.classList.add(sortDirection);
        renderTable();
      });
    });

    // New Customer Modal
    const modal = document.getElementById("new-customer-modal");
    document.getElementById("new-customer-btn").addEventListener("click", () => {
      modal.classList.add("is-active");
    });
    document.getElementById("close-modal").addEventListener("click", () => {
      modal.classList.remove("is-active");
      clearModal();
    });
    document.getElementById("cancel-modal").addEventListener("click", () => {
      modal.classList.remove("is-active");
      clearModal();
    });
    document.getElementById("save-customer").addEventListener("click", () => {
      const name = document.getElementById("new-name").value.trim();
      const type = document.getElementById("new-type").value;
      const email = document.getElementById("new-email").value.trim();
      const phone = document.getElementById("new-phone").value.trim();

      if (!name || !email || !phone) {
        showNotification("Please fill in all fields.", "is-danger");
        return;
      }

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showNotification("Please enter a valid email.", "is-danger");
        return;
      }

      const phoneRegex = /^\+?977\d{10}$/;
      if (!phoneRegex.test(phone)) {
        showNotification("Please enter a valid Nepal phone number (e.g., +9779814636172 or 9814636172).", "is-danger");
        return;
      }

      const newCustomer = {
        name,
        type,
        email,
        phone: phone.startsWith("+977") ? phone : `+977${phone}`,
        payment: "****7836",
        date: new Date().toISOString().split("T")[0]
      };
      customers.push(newCustomer);
      document.getElementById("total-results").textContent = customers.length;
      document.getElementById("total-count").textContent = `${customers.length} in total`;
      currentPage = 1;
      renderTable();
      modal.classList.remove("is-active");
      clearModal();
      showNotification("Customer added successfully!", "is-success");
    });

    function clearModal() {
      document.getElementById("new-name").value = "";
      document.getElementById("new-type").value = "Guest";
      document.getElementById("new-email").value = "";
      document.getElementById("new-phone").value = "";
    }

    // Export functionality
    document.getElementById("export-btn").addEventListener("click", () => {
      const format = prompt("Enter export format (csv or json):", "csv").toLowerCase();
      const filtered = filteredCustomers();
      if (format === "csv") {
        const csv = [
          ["Customer", "Type", "Email", "Phone", "Default Payment Method", "Create Date"],
          ...filtered.map(customer => [
            customer.name,
            customer.type,
            customer.email,
            customer.phone,
            customer.payment,
            customer.date
          ])
        ].map(row => row.join(",")).join("\n");
        const blob = new Blob([csv], { type: "text/csv" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "customers.csv";
        a.click();
        window.URL.revokeObjectURL(url);
      } else if (format === "json") {
        const json = JSON.stringify(filtered, null, 2);
        const blob = new Blob([json], { type: "application/json" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "customers.json";
        a.click();
        window.URL.revokeObjectURL(url);
      }
      showNotification(`Exported ${filtered.length} customers as ${format.toUpperCase()}.`, "is-success");
    });

    // Select all checkbox
    document.getElementById("select-all").addEventListener("change", (e) => {
      const checked = e.target.checked;
      document.querySelectorAll("#customer-table input[type='checkbox']").forEach(checkbox => {
        checkbox.checked = checked;
      });
      toggleBulkDelete();
    });

    // Bulk delete
    document.getElementById("bulk-delete-btn").addEventListener("click", () => {
      const selected = Array.from(document.querySelectorAll("#customer-table input[type='checkbox']:checked"))
        .map(checkbox => parseInt(checkbox.dataset.index));
      if (selected.length === 0) return;
      if (confirm(`Are you sure you want to delete ${selected.length} customers?`)) {
        customers = customers.filter((_, index) => !selected.includes(index));
        document.getElementById("total-results").textContent = customers.length;
        document.getElementById("total-count").textContent = `${customers.length} in total`;
        currentPage = 1;
        renderTable();
        showNotification(`${selected.length} customers deleted successfully.`, "is-success");
      }
    });

    // Page size change
    document.getElementById("page-size").addEventListener("change", (e) => {
      pageSize = parseInt(e.target.value);
      currentPage = 1; // Reset to first page when changing page size
      renderTable();
    });

    // Pagination
    document.getElementById("prev-page").addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
      }
    });

    document.getElementById("next-page").addEventListener("click", () => {
      const maxPage = Math.ceil(filteredCustomers().length / pageSize);
      if (currentPage < maxPage) {
        currentPage++;
        renderTable();
      }
    });

    // Filter customers based on menu, tab, and search
    function filteredCustomers() {
      let filtered = customers;

      // Apply menu filter
      if (currentMenuFilter === "1") {
        // All customers (default)
      } else if (currentMenuFilter === "2") {
        filtered = filtered.filter(customer => new Date(customer.date) > new Date("2023-01-01"));
      } else if (currentMenuFilter === "3") {
        filtered = filtered.filter(customer => customer.email.includes("yahoo.com"));
      } else if (currentMenuFilter === "4") {
        filtered = filtered.filter(customer => customer.phone.startsWith("+97798"));
      } else if (currentMenuFilter === "5") {
        filtered = filtered.filter(customer => customer.name.toLowerCase().startsWith("r"));
      } else if (currentMenuFilter === "6") {
        filtered = filtered.filter(customer => new Date(customer.date) < new Date("2021-01-01"));
      }

      // Apply tab filter
      if (currentTab !== "all") {
        filtered = filtered.filter(customer => customer.type.toLowerCase() === (currentTab === "accounts" ? "account" : "guest"));
      }

      // Apply search filter
      if (searchQuery) {
        filtered = filtered.filter(customer =>
          customer.name.toLowerCase().includes(searchQuery) ||
          customer.email.toLowerCase().includes(searchQuery) ||
          customer.phone.includes(searchQuery)
        );
      }

      // Apply sorting
      if (sortKey) {
        filtered = [...filtered].sort((a, b) => {
          const valA = a[sortKey].toLowerCase();
          const valB = b[sortKey].toLowerCase();
          if (sortKey === "date") {
            return sortDirection === "asc"
              ? new Date(valA) - new Date(valB)
              : new Date(valB) - new Date(valA);
          }
          return sortDirection === "asc"
            ? valA.localeCompare(valB)
            : valB.localeCompare(valA);
        });
      }

      return filtered;
    }

    // Render table and pagination
    function renderTable() {
      const tbody = document.getElementById("customer-table");
      const totalResults = document.getElementById("total-results");
      const totalCount = document.getElementById("total-count");
      const paginationButtons = document.getElementById("pagination-buttons");
      tbody.innerHTML = "";
      paginationButtons.innerHTML = "";

      const filtered = filteredCustomers();
      totalResults.textContent = filtered.length;
      totalCount.textContent = `${customers.length} in total`;
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const paginated = filtered.slice(start, end);

      paginated.forEach((customer, index) => {
        const globalIndex = customers.indexOf(customer);
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><input type="checkbox" class="row-checkbox" data-index="${globalIndex}"></td>
          <td>
            <div style="display: flex; align-items: center;">
              <img src="https://via.placeholder.com/30" alt="avatar" class="avatar">
              ${customer.name}
            </div>
          </td>
          <td>${customer.type}</td>
          <td>${customer.email}</td>
          <td>${customer.phone}</td>
          <td>${customer.payment}</td>
          <td>${new Date(customer.date).toLocaleDateString("en-US", { month: "short", day: "2-digit", year: "numeric" })}</td>
          <td>
            <div class="more-menu">
              <span class="is-clickable">‚ãÆ</span>
              <div class="dropdown-menu">
                <a class="dropdown-item" data-action="edit">Edit</a>
                <a class="dropdown-item" data-action="delete">Delete</a>
              </div>
            </div>
          </td>
        `;
        tbody.appendChild(row);

        // More menu actions
        const moreMenu = row.querySelector(".more-menu");
        moreMenu.addEventListener("click", (e) => {
          e.preventDefault();
          const action = e.target.dataset.action;
          if (action === "edit") {
            const newName = prompt("Edit customer name:", customer.name);
            if (newName) {
              customer.name = newName;
              renderTable();
              showNotification("Customer updated successfully!", "is-success");
            }
          } else if (action === "delete") {
            if (confirm("Are you sure you want to delete this customer?")) {
              customers.splice(globalIndex, 1);
              totalResults.textContent = filtered.length - 1;
              totalCount.textContent = `${customers.length} in total`;
              currentPage = 1;
              renderTable();
              showNotification("Customer deleted successfully.", "is-success");
            }
          }
        });

        // Checkbox change
        row.querySelector(".row-checkbox").addEventListener("change", toggleBulkDelete);
      });

      // Update pagination
      const maxPage = Math.ceil(filtered.length / pageSize);
      const prevButton = document.createElement("button");
      prevButton.className = "button is-small";
      prevButton.id = "prev-page";
      prevButton.textContent = "<";
      prevButton.disabled = currentPage === 1;
      paginationButtons.appendChild(prevButton);

      const pageRange = 3;
      const startPage = Math.max(1, currentPage - Math.floor(pageRange / 2));
      const endPage = Math.min(maxPage, startPage + pageRange - 1);

      for (let i = startPage; i <= endPage; i++) {
        const button = document.createElement("button");
        button.className = "button is-small";
        button.dataset.page = i;
        button.textContent = i;
        if (i === currentPage) button.classList.add("is-selected");
        paginationButtons.appendChild(button);
      }

      if (endPage < maxPage) {
        const ellipsis = document.createElement("span");
        ellipsis.textContent = "...";
        paginationButtons.appendChild(ellipsis);
        const lastButton = document.createElement("button");
        lastButton.className = "button is-small";
        lastButton.dataset.page = maxPage;
        lastButton.textContent = maxPage;
        paginationButtons.appendChild(lastButton);
      }

      const nextButton = document.createElement("button");
      nextButton.className = "button is-small";
      nextButton.id = "next-page";
      nextButton.textContent = ">";
      nextButton.disabled = currentPage === maxPage || maxPage === 0;
      paginationButtons.appendChild(nextButton);

      // Add event listeners to pagination buttons
      document.querySelectorAll("#pagination-buttons .button[data-page]").forEach(button => {
        button.addEventListener("click", () => {
          currentPage = parseInt(button.dataset.page);
          renderTable();
        });
      });
    }

    // Toggle bulk delete button
    function toggleBulkDelete() {
      const selected = document.querySelectorAll("#customer-table input[type='checkbox']:checked").length;
      const bulkDeleteBtn = document.getElementById("bulk-delete-btn");
      bulkDeleteBtn.style.display = selected > 0 ? "block" : "none";
    }

    // Show notification
    function showNotification(message, type) {
      const notification = document.createElement("div");
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.opacity = "0";
        setTimeout(() => notification.remove(), 500);
      }, 3000);
    }

    // Initial render
    document.querySelector(".menu-item[data-menu='1']").click();
    renderTable();
  </script>
</body>
</html>